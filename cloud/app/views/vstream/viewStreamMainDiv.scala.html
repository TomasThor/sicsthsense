@(streams : List[Stream], stream: Stream, myForm: Form[Stream], message: String="")

@import helper._
@streamPath=@{
if(stream.file != null && stream.file.getPath() != null) {
stream.file.getPath()
} else {
"ID: "+stream.id
}
}

@streamParentPath=@{
if(stream.file != null) {
stream.file.getParentPath()
} else {
"/"
}
}

@if(stream.canRead(Secured.getCurrentUser())) {
		<!--
  ~ Copyright (c) 2013, Swedish Institute of Computer Science
  ~ All rights reserved.
  ~ Redistribution and use in source and binary forms, with or without
  ~ modification, are permitted provided that the following conditions are met:
  ~     * Redistributions of source code must retain the above copyright
  ~       notice, this list of conditions and the following disclaimer.
  ~     * Redistributions in binary form must reproduce the above copyright
  ~       notice, this list of conditions and the following disclaimer in the
  ~       documentation and/or other materials provided with the distribution.
  ~     * Neither the name of The Swedish Institute of Computer Science nor the
  ~       names of its contributors may be used to endorse or promote products
  ~       derived from this software without specific prior written permission.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
  ~ ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
  ~ WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  ~ DISCLAIMED. IN NO EVENT SHALL THE SWEDISH INSTITUTE OF COMPUTER SCIENCE BE LIABLE
  ~ FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  ~ (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  ~ LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ~ ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  ~ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->

		<!--Body content-->
		<!-- Stream listing and visualizing -->
		<h1>Stream '@streamPath'</h1>
				<br />
				@helper.form(action = routes.CtrlStream.modify(stream.id), 'id -> "streamFormId") {

					<legend>View
						<span class="pull-right">@vstream.streamToolbar(stream, stream.canWrite(Secured.getCurrentUser()), false, stream.publicAccess || stream.publicSearch)

				@if( stream.canWrite(Secured.getCurrentUser()) ) {
				<span class="btn-group">
					<a href="@routes.Application.streams()" class="btn btn-small"><i class="icon-remove"></i></a>
					<button type="submit" name="update" class="btn btn-primary btn-small" id="updateStream" form="streamFormId"><i class="icon-ok icon-white"></i> Save</button>
	      </span>
				} </span>
					</legend>
					@vstream.includeStream(stream, displayHeader =true, displayOverview =true, displayPlot =true, displayToolbar =false)

			<div class="row-fluid">
			<label class="span2" for="@myForm("description").id"><h4>Description</h4></label>
			<textarea class="span10" wrap="soft" id="@myForm("description").id" name="@myForm("description").name" value="" placeholder="Stream description..." @if(!stream.canWrite(Secured.getCurrentUser())){readonly}>@myForm("description").value</textarea>
			</div>

					<fieldset>

		      <legend>Location</legend>
					<div id="map-canvas" style="width: 600px; height: 300px; float: center; border: 1px solid black;"></div>
					<br />
			<div class="row-fluid">
			<label>Latitude</label>
			<input class="span4 streamLat" type="number" step="any" id="@myForm("latitude").id" name="@myForm("latitude").name" value="@myForm("latitude").value" placeholder="0" @if(!stream.canWrite(Secured.getCurrentUser())){readonly}>
			<label>Longtitude</label>
			<input class="span4 streamLong" type="number" step="any" id="@myForm("longtitude").id" name="@myForm("longtitude").name" value="@myForm("longtitude").value" placeholder="0" @if(!stream.canWrite(Secured.getCurrentUser())){readonly}>
			</div>
					</fieldset>
    </div>
				}
    }

 <script type="text/javascript">
	     initializeMaps = function(e) {
	     streamButtonsHandler();
				selectPathInTree(null, "@streamPath");

	        var mapOptions = {
	          center: new google.maps.LatLng(@stream.latitude, @stream.longtitude),
						@if(stream.latitude==0 && stream.longtitude==0) {
							zoom: 1,
						} else {
							zoom: 7,
						}
	          mapTypeId: google.maps.MapTypeId.ROADMAP
	        };
	        var map = new google.maps.Map(document.getElementById("map-canvas"),
	            mapOptions);
					marker = new google.maps.Marker({
						position: new google.maps.LatLng(@stream.latitude, @stream.longtitude),
						draggable:@stream.canWrite(Secured.getCurrentUser()),
						animation:false,
						map: map
	      });
				google.maps.event.addListener(marker, 'dragend', function(event) {
	        document.getElementById("@myForm("latitude").id").value = this.getPosition().lat();
	        document.getElementById("@myForm("longtitude").id").value = this.getPosition().lng();
	       // $('.streamLat').val(this.getPosition().lat() );
	        //$('.streamLong').val(this.getPosition().lng() );
				});
	}
	      google.maps.event.addDomListener(window, 'load', initializeMaps);

		</script>
